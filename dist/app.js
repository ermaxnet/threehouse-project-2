var source = [{
  id: 1,
  name: "Miko\u0142aj Krzysztof Radziwi\u0142\u0142 Czarny",
  email: "mikolay@radzivill.by",
  at: "1515-02-04T15:56:05+00:00",
  avatar: "./assets/images/avatars/1.jpg"
}, {
  id: 2,
  name: "Barbara Radziwi\u0142\u0142\xF3wna",
  email: "barbara@radzivill.by",
  at: "1520-12-06T15:56:05+00:00",
  avatar: "./assets/images/avatars/2.jpg"
}, {
  id: 3,
  name: "Miko\u0142aj Krzysztof Radziwi\u0142\u0142",
  email: "mikolay_k@radzivill.by",
  at: "1549-08-02T15:56:05+00:00",
  avatar: "./assets/images/avatars/3.jpg"
}, {
  id: 4,
  name: "Krzysztof Miko\u0142aj Radziwi\u0142\u0142",
  email: "piorun@radzivill.by",
  at: "1547-02-09T15:56:05+00:00",
  avatar: "./assets/images/avatars/4.png"
}, {
  id: 5,
  name: "Jerzy Radziwi\u0142\u0142",
  email: "jerzy@radzivill.by",
  at: "1591-08-02T15:56:05+00:00",
  avatar: "./assets/images/avatars/5.jpg"
}, {
  id: 6,
  name: "Stanis\u0142aw Radziwi\u0142\u0142",
  email: "stanislaw@radzivill.by",
  at: "1559-05-12T15:56:05+00:00",
  avatar: "./assets/images/avatars/6.jpg"
}, {
  id: 7,
  name: "Janusz Radziwi\u0142\u0142",
  email: "janusz@radzivill.by",
  at: "1579-07-02T15:56:05+00:00",
  avatar: "./assets/images/avatars/7.jpg"
}, {
  id: 8,
  name: "Zofia z Olelkowicz\xF3w Radziwi\u0142\u0142owa",
  email: "zofia@radzivill.by",
  at: "1585-05-11T15:56:05+00:00",
  avatar: "./assets/images/avatars/8.jpg"
}, {
  id: 9,
  name: "Krzysztof Radziwi\u0142\u0142",
  email: "kryzstof_junior@radzivill.by",
  at: "1585-03-22T15:56:05+00:00",
  avatar: "./assets/images/avatars/9.jpg"
}, {
  id: 10,
  name: "Albrycht Stanis\u0142aw Radziwi\u0142\u0142",
  email: "stanislaw_a@radzivill.by",
  at: "1595-07-01T15:56:05+00:00",
  avatar: "./assets/images/avatars/10.jpg"
}, {
  id: 11,
  name: "Janusz Radziwi\u0142\u0142",
  email: "janusz_getman@radzivill.by",
  at: "1612-12-02T15:56:05+00:00",
  avatar: "./assets/images/avatars/11.jpg"
}, {
  id: 12,
  name: "Maria Radziwi\u0142\u0142owa",
  email: "maria@radzivill.by",
  at: "1625-01-01T15:56:05+00:00",
  avatar: "./assets/images/avatars/12.jpg"
}, {
  id: 13,
  name: "Bogus\u0142aw Radziwi\u0142\u0142",
  email: "boguslaw@radzivill.by",
  at: "1620-05-03T15:56:05+00:00",
  avatar: "./assets/images/avatars/13.png"
}, {
  id: 14,
  name: "Micha\u0142 Kazimierz Radziwi\u0142\u0142",
  email: "michail@radzivill.by",
  at: "1625-10-26T15:56:05+00:00",
  avatar: "./assets/images/avatars/14.jpg"
}, {
  id: 15,
  name: "Dominik Miko\u0142aj Radziwi\u0142\u0142",
  email: "dominik@radzivill.by",
  at: "1643-01-01T15:56:05+00:00",
  avatar: "./assets/images/avatars/15.png"
}, {
  id: 16,
  name: "Ludwika Karolina Radziwi\u0142\u0142",
  email: "ludwika@radzivill.by",
  at: "1667-02-27T15:56:05+00:00",
  avatar: "./assets/images/avatars/16.jpg"
}, {
  id: 17,
  name: "Karol Stanis\u0142aw Radziwi\u0142\u0142",
  email: "karol@radzivill.by",
  at: "1669-11-27T15:56:05+00:00",
  avatar: "./assets/images/avatars/17.jpg"
}, {
  id: 18,
  name: "Jan Miko\u0142aj Radziwi\u0142\u0142",
  email: "jan@radzivill.by",
  at: "1681-05-17T15:56:05+00:00",
  avatar: "./assets/images/avatars/18.png"
}, {
  id: 19,
  name: "Miko\u0142aj Faustyn Radziwi\u0142\u0142",
  email: "mikolay@radzivill.by",
  at: "1688-05-21T15:56:05+00:00",
  avatar: "./assets/images/avatars/19.png"
}, {
  id: 20,
  name: "Micha\u0142 Kazimierz Radziwi\u0142\u0142 Rybe\u0144ko",
  email: "michal_rybenko@radzivill.by",
  at: "1702-06-13T15:56:05+00:00",
  avatar: "./assets/images/avatars/20.jpg"
}, {
  id: 21,
  name: "Franciszka Urszula Radziwi\u0142\u0142owa",
  email: "franciszka@radzivill.by",
  at: "1705-02-13T15:56:05+00:00",
  avatar: "./assets/images/avatars/21.jpg"
}, {
  id: 22,
  name: "Udalryk Krzysztof Radziwi\u0142\u0142",
  email: "udarlik@radzivill.by",
  at: "1712-01-05T15:56:05+00:00",
  avatar: "./assets/images/avatars/22.jpg"
}, {
  id: 23,
  name: "Karol Stanis\u0142aw Radziwi\u0142\u0142 Panie Kochanku",
  email: "karol_kochanku@radzivill.by",
  at: "1734-02-27T15:56:05+00:00",
  avatar: "./assets/images/avatars/23.png"
}];
{
  /* Simple realization of float placeholder. In real life project
     you would surely like to analyze whether the field has a value from the start.
     But I consider it needless for our example.
  */
  var activePlaceholder = function activePlaceholder(element) {
    var action = function action() {
      if (element.val()) {
        element.addClass("fill");
      } else {
        element.removeClass("fill");
      }
    };

    element.on("blur clear-search-field", action);
  };
  /* Array realization logics encapsulated in jQuery-extension.
     i.e. the task is realized as a simple jQuery-plugin.
  */


  $.fn.listItems = function (options) {
    // Default settings
    var defaultOptions = {
      total: 10,
      enabledSearchBox: true,
      searchPlaceholder: "Start entering name or email",
      noData: "<div class=\"no-students\">\n                    <span>Sorry, no princes here</span>\n                </div>",
      source: new Array(0)
    };
    options = Object.assign({}, defaultOptions, options); // Some global for plugin variables 

    var context = this;
    var listContext = null;
    var pagerContext = null;
    var dirty = false;
    var hasPager = false;
    /* Application status. Let's pay some respect to React, as far as after long practice with it 
       my hands automatically long to realize logics in that way.
    */

    var state = {
      page: 0,
      oldPage: 0,
      source: options.source,
      total: 0,
      totalPages: 0
    };
    /* To make it more simple some plugin helper methods encapsulated into separate name space. 
    */

    var API = {
      /* Search field mapping. In my example I decided not to make a search button (hope, is not a
         too big violation of task conditions). I made a simple autocomplete here.
      */
      buildSearchBox: function buildSearchBox() {
        var _this = this;

        if (!this.hasSource()) {
          return;
        }

        var searchBox = $("<div class=\"search-box\">\n                        <form action=\"#\" class=\"search-box__form\">\n                            <div class=\"search-box__input\">\n                                <input type=\"search\" name=\"search\" id=\"search\" />\n                                <span class=\"active-placeholder\">".concat(options.searchPlaceholder, "</span>\n                            </div>\n                        </form>\n                    </div>"));
        context.before(searchBox);
        var search = searchBox.find("[type=\"search\"], [type=\"text\"]");
        activePlaceholder(search); // Just in case it is better to disable form submission on Enter button pressing

        searchBox.find("form").on("keyup keypress", function (e) {
          var keyCode = e.keyCode || e.which;

          if (keyCode === 13) {
            e.preventDefault();
            return false;
          }
        });
        /* Search logics. On input event expiration if a certain value entered 
            then we start searching for  matching among names and e-mails. If the value is empty then  
            a source list is displaying. Of course in real life project you might want to limit search start with
            a certain quantity of symbols or call frequency by using kind of debounce method.  But
            I didn't implement it here. By the way I am aware of input event doesn't work in old version IE and
            there exist onpropertychange to resolve it, but we shouldn't focus on IE8 in our 2018. 
            IMPORTANT: filter searches by  letter combination entered (I just consider it to be more interesting)
        */

        search.on("input", function (e) {
          var value = $(e.target).val();

          if (value) {
            var _source = options.source.filter(function (item) {
              var pattern = new RegExp(value, "i");
              return pattern.test(item.name) || pattern.test(item.email);
            });

            var newState = {
              source: _source,
              page: 0
            };
            /*Save selected page to return to it when a user cleans a search field 
            */

            if (state.page) {
              newState.oldPage = state.page;
            }

            state = Object.assign({}, state, newState);

            _this.build();
          } else {
            state = Object.assign({}, state, {
              source: options.source,
              page: state.oldPage
            });

            _this.build();
          }
        });
      },

      /* Build pagination in case of need (i.e.the data array is more than for one page).
         Build is based on object current state 
      */
      buildPager: function buildPager() {
        var pager = "<div class=\"pager-box\">\n                        <ol class=\"pager\">[pages]</ol>\n                        <div class=\"pager__range-mark\">\n                            <span class=\"range\"></span>\n                            <span>out of</span>\n                            <span class=\"count\">".concat(state.total, "</span>\n                        </div>\n                    </div>");
        var pages = "";

        for (var i = 0; i < state.totalPages; i++) {
          pages += "<li class=\"page".concat(i === state.page ? " state_active" : "", "\" data-page=\"").concat(i, "\">\n                            ").concat(i + 1, "\n                        </li>");
        }

        pager = pager.replace(/\[pages\]/i, pages);
        context.after(pager);
        pagerContext = $(".pager-box");
      },

      /* Adding to list DOM element. The method is quite simple, but I separated it
         to save a plugin modal system (and just in case we need that in future)
      */
      buildList: function buildList() {
        listContext = $("<ul class=\"students__list\"></ul>");
        context.prepend(listContext);
      },

      /* Add new element to the list according to template
      */
      buildItem: function buildItem(item) {
        listContext.append("<li class=\"students__item student\" data-item-id=\"".concat(item.id, "\">\n                        <div class=\"student__avatar\">\n                            <img alt=\"").concat(item.name, "\" src=\"").concat(item.avatar, "\" />\n                        </div>\n                        <div class=\"student__contact\">\n                            <div class=\"student__name\">\n                                <span>").concat(item.name, "</span>\n                            </div>\n                            <div class=\"student__email\">\n                                <a href=\"mailto:").concat(item.email, "\">").concat(item.email, "</a>\n                            </div>\n                        </div>\n                        <div class=\"mark\">\n                            <span>Born</span>\n                            <time datetime=\"").concat(item.at, "\">\n                                ").concat(new Date(item.at).toLocaleDateString(), "\n                            </time>\n                        </div>\n                    </li>"));
      },

      /* Deleting programmatically created elements from DOM and cleaning global variables 
      before list rebuild
      */
      clear: function clear() {
        if (dirty) {
          context.html("");
          dirty = false;
          listContext = null;
        }

        if (hasPager && pagerContext) {
          pagerContext.remove();
          hasPager = false;
          pagerContext = null;
        }
      },
      // Get elements for current page from state
      getItems: function getItems() {
        var lastIndex = state.total - 1;
        var startIndex = state.page * options.total;
        var endIndex = startIndex + options.total - 1;

        if (endIndex > lastIndex) {
          endIndex = lastIndex;
        }

        var items = new Array(0);

        for (var i = startIndex; i <= endIndex; i++) {
          items.push(state.source[i]);
        }

        if (hasPager) {
          var markRange = pagerContext.find(".range");
          markRange.text("".concat(startIndex + 1, " - ").concat(endIndex + 1));
        }

        return items;
      },
      // Add all elements for current page to the list
      buildItems: function buildItems() {
        if (!listContext) {
          return;
        }

        listContext.html("");
        var items = this.getItems();
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = items[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var _item = _step.value;
            this.buildItem(_item);
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return != null) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      },
      // Add possible events for the list (i.e. page transitions)
      bindListEvents: function bindListEvents() {
        var _this2 = this;

        if (hasPager) {
          var pages = pagerContext.find(".page");
          pages.click(function (e) {
            pages.removeClass("state_active");
            var page = $(e.target).closest("li");
            page.addClass("state_active");
            state = Object.assign({}, state, {
              page: page.data("page")
            });

            _this2.buildItems();
          });
        }
      },

      /* Does a state have any elements to display? Here I dodged a bit. The method is called twice:
         each time when a new list is building and when search field is being depicted. Search field 
         is displaying only once, that is why the method will return true only if set of element  is more than null.
      */
      hasSource: function hasSource() {
        return state.source instanceof Array && state.source.length;
      },
      // Call all needed methods and display list
      build: function build() {
        this.clear();

        if (!this.hasSource()) {
          return context.html(options.noData);
        }

        var listSize = state.source.length;
        var pagesCount = Math.ceil(listSize / options.total);
        this.buildList();
        state = Object.assign({}, state, {
          total: listSize,
          totalPages: pagesCount
        });

        if (state.totalPages > 1) {
          this.buildPager();
          hasPager = true;
        } else {
          hasPager = false;
        }

        this.buildItems();
        dirty = true;
        this.bindListEvents();
      }
    };
    /* Display list at application start and if search field is enabled
    */

    var init = function init() {
      API.build();

      if (options.enabledSearchBox) {
        API.buildSearchBox();
      }
    };

    init();
  };

  $(document).ready(function () {
    $("#year").text(new Date().getFullYear());
    $(".students").listItems({
      source: source
    });
  });
}